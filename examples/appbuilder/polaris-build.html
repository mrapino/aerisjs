<!DOCTYPE html>
<html>
<head>
  <title>MapAppBuilder</title>

  <link rel="shortcut icon" type="image/x-icon" href="../weather.ico"/>

  <link rel="stylesheet" href="../../lib/polaris/builder/routeplanner/theme/css/style.css"/>
  <style type="text/css">
    #app {
      margin: 20px auto;
      width: 960px;
      height: 600px;
    }
  </style>
  <script type="text/javascript"
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxTEbJsXwGRW4zDj8fpVsenDMMQGhZhUU&sensor=false&libraries=geometry">
  </script>

  <script type="text/javascript" src="../../build/packages/routeplanner.js"></script>

</head>
<body>
<div id="app"></div>

<script type="text/javascript">
  aeris.Loader.load({
    RiderX: {
      apiId: 'wgE96YE3scTQLKjnqiMsv',
      apiSecret: 'DGCTq4z2xxttTBwTiimwlWyxmx5IDwK0VZ7T2WMS',
      el: document.getElementById('app'),
      mapType: 'gmaps',
      mapOptions: {
        center: [44.97307701415332, -93.26208114624023],
        zoom: 14
      },
      onload: function(exposed) {
        console.log('builder complete');
        window.exposed = exposed;
        window.state = exposed.get('state');
        window.eventHub = exposed.get('eventHub');

        eventHub.on('route:export', function(route) {
          eventHub.trigger('save:start');

          _.delay(resolveSaveRoute, 1000);
          console.log(JSON.stringify(route, null, 2));
        });
      }
    }
  });




  function resolveSaveRoute() {
    if (window.stubRouteError) {
      eventHub.trigger('save:error', new Error('Error saving route.'));
    }
    else {
      eventHub.trigger('save:complete');
      alert('Check console for exported route');
    }
  }
</script>
</body>
</html>