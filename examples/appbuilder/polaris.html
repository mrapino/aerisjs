<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <title>Polaris AppBuilder Example</title>

  <link rel="shortcut icon" type="image/x-icon" href="../weather.ico"/>
  <link rel="stylesheet" href="../../lib/polaris/builder/routeplanner/theme/css/style.css"/>


  <style type="text/css">
    #app {
      margin: 20px auto;
      width: 960px;
      height: 600px;
    }
  </style>

  <script type="text/javascript"
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxTEbJsXwGRW4zDj8fpVsenDMMQGhZhUU&sensor=false&libraries=geometry">
  </script>
  <script type="text/javascript" src="../../externals/require.js" data-main="../initialize"></script>
  <script type="text/javascript">
    function initialize() {
      require.setStrategy('gmaps');
      require([
        'polaris/routeplanner/routeplannerbuilder',
        'aeris/util',
        'vendor/jquery',
        'packages/layers',
        'packages/markers',
        'polaris/maps/packages/markers',
        'polaris/maps/packages/layers',
        'polaris/maps/base/polylines/trailpolyline'
      ], function(AppBuilder) {
        window._ = require('aeris/util');
        window.$ = require('vendor/jquery');

        var builder = new AppBuilder({
          el: document.getElementById('app'),
          mapOptions: {
            zoom: 8,
            center: [35, -85]
          },
          publicTrails: {
            default: false,
            trailTypes: ['snow', 'orv']
          },
          onload: function(exposed) {
            console.log('builder complete');
            window.exposed = exposed;
            window.state = exposed.get('state');
            window.eventHub = exposed.get('eventHub');
            window.map = state.get('map');

            eventHub.on('route:export', function(route) {
              eventHub.trigger('save:start');

              _.delay(resolveSaveRoute, 1000);
              console.log(JSON.stringify(route, null, 2));
            });

            function resolveSaveRoute() {
              if (window.stubRouteError) {
                eventHub.trigger('save:error', new Error('Error saving route.'));
              }
              else {
                eventHub.trigger('save:complete');
                alert('Check console for exported route');
              }
            }
          }
        });
        builder.build()
      });
    }
  </script>
</head>
<body>
  <div id="app"></div>
</body>
</html>